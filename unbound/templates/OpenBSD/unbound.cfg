{{ansible_managed|comment(decoration='#')}}

{% if (unbound_state is match('start|on|enable')) %}
check process unbound matching "unbound -c.*"
  start program = "/usr/sbin/rcctl start {{service_name_unbound}}"
  stop program = "/usr/sbin/rcctl stop {{service_name_unbound}}"
{% if not (unbound_interface == []) %}
{% for item in unbound_interface %}
  if failed host {{item.address}} port {% if not ((item.port|default('53')) == '') %}{{(item.port|int(53))}}{% endif %} type tcp protocol dns with timeout 10 seconds then alert
  if failed host {{item.address}} port {% if not ((item.port|default('53')) == '') %}{{(item.port|int(53))}}{% endif %} type udp protocol dns with timeout 10 seconds then alert
{% endfor %}
{% endif %}
  if 5 restarts within 5 cycles then unmonitor
{% endif %}
