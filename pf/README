--------------------------------------------------------------------------------
README
--------------------------------------------------------------------------------
        o
    ____|____
   |         |  Name   : pf
   |  _   _  |  Type   : ansible role
   | [_] [_] |  Group  : net-firewall
   |____~____|
    ___//__//   Authors: robomon community
   /|     |/    License: Simplified BSD License
  //|_____|
    _|| ||_     Webpage: http://www.robomon.org/
   (__| |__)
--------------------------------------------------------------------------------
DESCRIPTION
--------------------------------------------------------------------------------

This role manages pf.

PF (Packet Filter) is a BSD licensed stateful packet filter, a central piece of
software for firewalling. PF is developed on OpenBSD, but has been ported to
many other operating systems including FreeBSD, NetBSD, DragonFly BSD and
Mac OS X.

For more detailed information on the usage and available configuration options
please consult the following sections.

--------------------------------------------------------------------------------
USAGE
--------------------------------------------------------------------------------

INSTALL
  - hosts: all
    roles:
     - role: pf
       pf_state: 'install'

ENABLE
  - hosts: all
    roles:
     - role: pf
       pf_state: 'enable'
       pf_filter_in_ip_custom:
        - 'pass in inet proto tcp from any to port 25 $tcp_state # SMTP - from any'
        - 'pass in inet proto tcp from any to port 80 $tcp_state # HTTP - from any'
        - 'pass in inet proto tcp from any to port 443 $tcp_state # HTTPS - from any'
        - 'pass in inet proto tcp from any to port 587 $tcp_state # SMTPS - from any'
        - 'pass in inet proto tcp from any to port 993 $tcp_state # IMAPS - from any'
       pf_filter_in_ip_default:
        - 'pass in inet proto tcp from 192.168.1.0/24 to port 22 $tcp_state # SSH - from internal network'
       pf_filter_out_ip_custom:
        - 'pass out inet proto tcp to any port 25 $tcp_state # SMTP - to any'
        - 'pass out inet proto tcp to any port 587 $tcp_state # SMTPS - to any'
       pf_filter_out_ip_default:
        - 'pass out inet proto tcp to 192.168.1.2 port 53 $tcp_state # DNS - to primary dns server'
        - 'pass out inet proto tcp to 192.168.1.3 port 53 $tcp_state # DNS - to secondary dns server'
        - 'pass out inet proto udp to 192.168.1.2 port 53 $udp_state # DNS - to primary dns server'
        - 'pass out inet proto udp to 192.168.1.3 port 53 $udp_state # DNS - to secondary dns server'
        - 'pass out inet proto tcp to 192.168.1.5 port 80 $tcp_state # HTTP - to internal mirror'
        - 'pass out inet proto udp to any 192.168.1.4 123 $udp_state # NTP - to ntp server'
        - 'pass out inet proto tcp to any 192.168.1.5 443 $tcp_state # HTTPS - to internal mirror'

DISABLE
  - hosts: all
    roles:
     - role: pf
       pf_state: 'disable'
       pf_filter_in_ip_custom:
        - 'pass in inet proto tcp from any to port 25 $tcp_state # SMTP - from any'
        - 'pass in inet proto tcp from any to port 80 $tcp_state # HTTP - from any'
        - 'pass in inet proto tcp from any to port 443 $tcp_state # HTTPS - from any'
        - 'pass in inet proto tcp from any to port 587 $tcp_state # SMTPS - from any'
        - 'pass in inet proto tcp from any to port 993 $tcp_state # IMAPS - from any'
       pf_filter_in_ip_default:
        - 'pass in inet proto tcp from 192.168.1.0/24 to port 22 $tcp_state # SSH - from internal network'
       pf_filter_out_ip_custom:
        - 'pass out inet proto tcp to any port 25 $tcp_state # SMTP - to any'
        - 'pass out inet proto tcp to any port 587 $tcp_state # SMTPS - to any'
       pf_filter_out_ip_default:
        - 'pass out inet proto tcp to 192.168.1.2 port 53 $tcp_state # DNS - to primary dns server'
        - 'pass out inet proto tcp to 192.168.1.3 port 53 $tcp_state # DNS - to secondary dns server'
        - 'pass out inet proto udp to 192.168.1.2 port 53 $udp_state # DNS - to primary dns server'
        - 'pass out inet proto udp to 192.168.1.3 port 53 $udp_state # DNS - to secondary dns server'
        - 'pass out inet proto tcp to 192.168.1.5 port 80 $tcp_state # HTTP - to internal mirror'
        - 'pass out inet proto udp to any 192.168.1.4 123 $udp_state # NTP - to ntp server'
        - 'pass out inet proto tcp to any 192.168.1.5 443 $tcp_state # HTTPS - to internal mirror'

REMOVE
  - hosts: all
    roles:
     - role: pf
       pf_state: 'remove'

--------------------------------------------------------------------------------
VARIABLES
--------------------------------------------------------------------------------

ROLE
  pf_state
    Description: Control the state of the role.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'enable'
    Options    :
      Install: 'true' | 'yes' | 'install'
      Enable : 'start' | 'on' | 'enable'
      Disable: 'stop' | 'off' | 'disable'
      Remove : 'false' | 'no' | 'remove'

  pf_blacklist_custom
    Description: Define the 'pf_blacklist_custom' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ['173.194.40.40',
                 '74.125.148.0/22',
                 'google.com']
      None    : []

  pf_blacklist_default
    Description: Define the 'pf_blacklist_default' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ['173.194.40.40',
                 '74.125.148.0/22',
                 'google.com']
      None    : []

  pf_filter_in_icmp
    Description: Define the 'pf_filter_in_icmp' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ['pass in inet proto icmp icmp-type echoreq $udp_state # Echo request - from any',
                 'pass in inet6 proto icmp6 icmp6-type echoreq $udp_state # Echo request - from any']
      None    : []

  pf_filter_in_ip_custom
    Description: Define the 'pf_filter_in_ip_custom' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ['pass in inet proto tcp from 192.168.1.0/24 to port 22 $tcp_state # SSH - from internal network',
                 'pass in inet proto tcp from any to port 25 $tcp_state # SMTP - from any',
                 'pass in inet proto tcp from any to port 53 $tcp_state # DNS - from any',
                 'pass in inet proto udp from any to port 53 $udp_state # DNS - from any',
                 'pass in inet proto tcp from any to port 80 $tcp_state # HTTP - from any',
                 'pass in inet proto udp from 192.168.1.0/24 to port 123 $udp_state # NTP - from internal network',
                 'pass in inet proto tcp from any to port 443 $tcp_state # HTTPS - from any',
                 'pass in inet proto tcp from 192.168.1.0/24 to port 514 $tcp_state # SYSLOG - from internal network',
                 'pass in inet proto tcp from any to port 587 $tcp_state # SMTPS - from any',
                 'pass in inet proto tcp from any to port 993 $tcp_state # IMAPS - from any']
      None    : []

  pf_filter_in_ip_default
    Description: Define the 'pf_filter_in_ip_default' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : ['pass in inet proto tcp from 192.168.0.0/16 to port 22 $tcp_state # SSH - from Private Address Space (RFC 1918)',
                  'pass in inet proto tcp from 172.16.0.0/12 to port 22 $tcp_state # SSH - from Private Address Space (RFC 1918)',
                  'pass in inet proto tcp from 10.0.0.0/8 to port 22 $tcp_state # SSH - from Private Address Space (RFC 1918)']
    Options    :
      Examples: ['pass in inet proto tcp from 192.168.1.0/24 to port 22 $tcp_state # SSH - from internal network']
      None    : []

  pf_filter_in_policy
    Description: Control the 'pf_filter_in_policy' option.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'block'
    Options    :
      Block: 'block'
      Pass : 'pass'

  pf_filter_out_icmp
    Description: Define the 'pf_filter_out_icmp' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : ['pass out inet proto icmp icmp-type echoreq $udp_state # Echo request - to any',
                  'pass out inet6 proto icmp6 icmp6-type echoreq $udp_state # Echo request - to any']
    Options    :
      Examples: ['pass out inet proto icmp icmp-type echoreq $udp_state # Echo request - to any',
                 'pass out inet6 proto icmp6 icmp6-type echoreq $udp_state # Echo request - to any']
      None    : []

  pf_filter_out_ip_custom
    Description: Define the 'pf_filter_out_ip_custom' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ['pass out inet proto tcp to 192.168.1.0/24 port 22 $tcp_state # SSH - to internal network',
                 'pass out inet proto tcp to 192.168.1.10 port 512 $tcp_state # SYSLOG - to internal log server']
      None    : []

  pf_filter_out_ip_default
    Description: Define the 'pf_filter_out_ip_default' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : ['pass out inet proto tcp to any port 53 $tcp_state # DNS - to any',
                  'pass out inet proto udp to any port 53 $udp_state # DNS - to any',
                  'pass out inet proto tcp to any port 80 $tcp_state # HTTP - to any',
                  'pass out inet proto udp to any port 123 $udp_state # NTP - to any',
                  'pass out inet proto tcp to any port 443 $tcp_state # HTTPS - to any']
    Options    :
      Examples: ['pass out inet proto tcp to any port 53 $tcp_state # DNS - to any',
                 'pass out inet proto udp to any port 123 $udp_state # NTP - to any']
      None    : []

  pf_filter_out_policy
    Description: Control the 'pf_filter_out_policy' option.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'block'
    Options    :
      Block: 'block'
      Pass : 'pass'

  pf_macro_custom
    Description: Define the 'pf_macro_custom' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ["host_fw = '192.168.1.1'"] |
                ["net_int = '192.168.1.0/24'", "net_dmz = '192.168.2.0/24'"]
      None    : []

  pf_macro_default
    Description: Define the 'pf_macro_default' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ["host_fw = '192.168.1.1'"] |
                ["net_int = '192.168.1.0/24'", "net_dmz = '192.168.2.0/24'"]
      None    : []

  pf_macro_if_dmz
    Description: Define the 'pf_macro_if_dmz' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : ''
    Options    :
      Examples: 'em0' | 'ed1' | 'wlan2'
      None    : ''

  pf_macro_if_ext
    Description: Define the 'pf_macro_if_ext' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : ''
    Options    :
      Examples: 'em0' | 'ed1' | 'wlan2'
      None    : ''

  pf_macro_if_int
    Description: Define the 'pf_macro_if_int' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : ''
    Options    :
      Examples: 'em0' | 'ed1' | 'wlan2'
      None    : ''

  pf_macro_tcp_state
    Description: Define the 'pf_macro_tcp_state' option.
                 The flags 'S/SA' are safe when using scrubbing. Use the flags
		 'S/SFRA' when scrubbing is disabled.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : 'flags S/SA modulate state'
    Options    :
      Examples: 'flags S/SA modulate state' |
                'flags S/SFRA modulate state'

  pf_macro_udp_state
    Description: Define the 'pf_macro_udp_state' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : 'keep state'
    Options    :
      Examples: 'keep state'

  pf_option_block_policy
    Description: Control the 'pf_option_block_policy' option.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'drop'
    Options    :
      Drop  : 'drop'
      Return: 'return'

  pf_option_debug
    Description: Control the 'pf_option_debug' option.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'urgent'
    Options    :
      None  : 'none'
      Urgent: 'urgent'
      Misc  : 'misc'
      Loud  : 'loud'

  pf_option_fingerprints
    Description: Define the 'pf_option_fingerprints' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : '/etc/pf.os'
    Options    :
      Examples: '/etc/pf.os' | '/etc/pf.os-fingerprints'

  pf_option_hostid
    Description: Define the 'pf_option_hostid' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : ''
    Options    :
      Examples: '1' | '2' | '3'
      None    : ''

  pf_option_limit
    Description: Define the 'pf_option_limit' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ['states 20000', 'frags 20000', 'src-nodes 2000'] |
                ['tables 1000', 'table-entries 100000']
      None    : []

  pf_option_loginterface
    Description: Define the 'pf_option_loginterface' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : 'none'
    Options    :
      Examples: 'em0' | 'ed1' | 'wlan2'
      None    : 'none' | 'false' | 'no' | 'disable'

  pf_option_optimization
    Description: Control the 'pf_option_optimization' option.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'normal'
    Options    :
      Normal      : 'normal'
      High-Latency: 'high-latency'
      Satellite   : 'satellite'
      Aggressive  : 'aggressive'
      Conservative: 'conservative'

  pf_option_ruleset_optimization
    Description: Control the 'pf_option_ruleset_optimization' option.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'none'
    Options    :
      Basic  : 'basic'
      Profile: 'profile'
      None   : 'none' | 'false' | 'no' | 'disable'


  pf_option_skip
    Description: Define the 'pf_option_skip' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : ['lo']
    Options    :
      Examples: ['lo'] | ['lo', 'em0']
      None    : []

  pf_option_state_defaults
    Description: Define the 'pf_option_state_defaults' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ['pflow', 'no-sync']
      None    : []

  pf_option_state_policy
    Description: Control the 'pf_option_state_policy' option.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'if-bound'
    Options    :
      Floating: 'floating'
      If-Bound: 'if-bound'

  pf_option_timeout
    Description: Define the 'pf_option_timeout' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : []
    Options    :
      Examples: ['tcp.first 120'] | ['tcp.established 86400'] |
                ['adaptive.start 6000', 'adaptive.end 12000']
      None    : []

  pf_pf_blacklist_template
    Description: Define the template source for 'pf.blacklist.j2'.
                 Any value other than 'main' requires a Jinja2 file to be
                 created. The custom Jinja2 file for an example configuration
                 called 'example' needs to be placed as follows:
                 'pf/templates/example/pf.blacklist.j2'
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : 'main'
    Options    :
      Examples: 'example' | 'environment' | 'hostname'

  pf_pf_conf_template
    Description: Define the template source for 'pf.conf.j2'.
                 Any value other than 'main' requires a Jinja2 file to be
                 created. The custom Jinja2 file for an example configuration
                 called 'example' needs to be placed as follows:
                 'pf/templates/example/pf.conf.j2'
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : 'main'
    Options    :
      Examples: 'example' | 'environment' | 'hostname'

  pf_scrub
    Description: Define the 'pf_scrub' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : ['in all fragment reassemble',
                  'out all random-id fragment reassemble']
    Options    :
      Examples: ['in all fragment reassemble',
                 'out all random-id fragment reassemble']
      None    : []

  pf_table_blacklist
    Description: Define the 'pf_table_blacklist' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : String
    Default    : "{{file_path_pf_blacklist}}"
    Options    :
      Examples: '/etc/pf.blacklist' | '/etc/pf.black-list'

  pf_table_custom
    Description: Define the 'pf_table_custom' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : ['<rfc1918> const { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 }']
    Options    :
      Examples: ["<spam> persist file '/etc/pf.spammers'"]
      None    : []

  pf_table_default
    Description: Define the 'pf_table_default' option.
    Implemented: 0.1
    Required   : False
    Value      : Arbitrary
    Type       : Array
    Default    : ['<rfc1918> const { 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 }']
    Options    :
      Examples: ["<spam> persist file '/etc/pf.spammers'"]
      None    : []

  pf_table_require_order
    Description: Control the 'pf_table_require_order' option.
    Implemented: 0.1
    Required   : False
    Value      : Predetermined
    Type       : String
    Default    : 'yes'
    Options    :
      Yes: 'true' | 'yes' | 'install'
      No : 'false' | 'no' | 'disable'

--------------------------------------------------------------------------------
CONFLICTS
--------------------------------------------------------------------------------

ROLES

--------------------------------------------------------------------------------
DEPENDENCIES
--------------------------------------------------------------------------------

PACKAGES

ROLES

VARIABLES

--------------------------------------------------------------------------------
REQUIREMENTS
--------------------------------------------------------------------------------

CONTROL MACHINE
  Ansible
    Version: >= 1.6

  Python
    Version: >= 2.4

  Python-Crypto
    Version: >= 2.0

  Python-Jinja2
    Version: >= 2.0

  Python-Paramiko
    Version: >= 1.0

  Python-YAML
    Version: >= 3.0

  sshpass
    Version: >= 1.0

MANAGED NODE
  Python
    Version: >= 2.4

--------------------------------------------------------------------------------
SUPPORT
--------------------------------------------------------------------------------

OPERATING SYSTEMS
  FreeBSD
    Version: 10
      Status: Development

  Gentoo
    Version: 2
      Status: Unsupported

--------------------------------------------------------------------------------
OTHER
--------------------------------------------------------------------------------
