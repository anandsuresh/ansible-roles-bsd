#-------------------------------------------------------------------------------
#                             ANSIBLE MANAGED FILE
#-------------------------------------------------------------------------------

#-------------------------------------------------------------------------------
# INFORMATION
#-------------------------------------------------------------------------------
#
# Name   : nsd.conf
# Type   : nsd configuration file
# Role   : nsd
#
# Authors: liv community
# License: Simplified BSD License
#
#-------------------------------------------------------------------------------

# $OpenBSD: nsd.conf,v 1.11 2015/04/12 11:49:39 sthen Exp $

#-------------------------------------------------------------------------------
# SERVER
#-------------------------------------------------------------------------------

server:
	verbosity: 1
	database: "" # disable database

        #-----------------------------------------------------------------------
        # INTERFACE
        #-----------------------------------------------------------------------

{% if (nsd_interface is defined) and not (nsd_interface == []) %}
{% for interface in nsd_interface %}
{% if (interface.comment is defined) %}
        # {{interface.comment}}
{% endif %}
        interface: {{interface.address}}{% if (interface.port is defined) %}@{{interface.port|int(53)}}{% endif %}

{% endfor %}
{% else %}
        interface: 127.0.0.1
{% endif %}

        #-----------------------------------------------------------------------
        # PORT
        #-----------------------------------------------------------------------

{% if not (nsd_default_port == '') %}
        port: {{(nsd_default_port|int(53))}}
{% endif %}

        #-----------------------------------------------------------------------
        # INTERNET-PROTOCOL
        #-----------------------------------------------------------------------

{% if (nsd_ip4_state is match('false|no|disable')) %}
        do-ip4: no
{% else %}
        do-ip4: yes
{% endif %}
{% if (nsd_ip6_state is match('true|yes|enable')) %}
        do-ip6: yes
{% else %}
        do-ip6: no
{% endif %}

        #-----------------------------------------------------------------------
        # IDENTITY
        #-----------------------------------------------------------------------

{% if (nsd_hide_version is match('false|no|disable')) %}
        hide-version: no
{% else %}
        hide-version: yes
{% endif %}

{% if not (nsd_identity == '') %}
        identity: "{{nsd_identity}}"
{% endif %}

        #-----------------------------------------------------------------------
        # VERSION
        #-----------------------------------------------------------------------

{% if not (nsd_version == '') %}
        version: "{{nsd_version}}"
{% endif %}

#-------------------------------------------------------------------------------
# REMOTE CONTROL
#-------------------------------------------------------------------------------

remote-control:
        control-enable: yes
	control-interface: /var/run/nsd.sock

#-------------------------------------------------------------------------------
# KEY
#-------------------------------------------------------------------------------

## tsig key example
#key:
#	name: "tsig1.example.com."
#	algorithm: hmac-sha256
#	secret: "bWVrbWl0YXNkaWdvYXQ="

#-------------------------------------------------------------------------------
# ZONE
#-------------------------------------------------------------------------------

{% if (nsd_zone is defined) and not (nsd_zone == []) %}
{% for zone in nsd_zone %}
{% if not (zone.state|default('') is match('false|no|disable')) %}
zone:
{% if (zone.comment is defined) %}
        # {{zone.comment}}
{% endif %}
        name: "{{zone.name}}"
        zonefile: "{{file_dst_zone_config_zone}}/{{zone.name}}.zone"
{% endif %}

{% endfor %}

{% endif %}
